# bs

bs - автоматизированная система сборки LFA из исходного кода. От пользователя требуется выбрать модель компьютера, для которого производить сборку и при необходимости указать пару опциональных параметров, после чего начать автоматическую сборку.

## Порядок действий

Настроить систему сборки. На этапе настройки пользователь выбирает модель материнской платы или одноплатного компьютера, для которого предназначена собираемая система LFA. В слуае, если для этого компьютера возможна сборка нескольких версий ядра Linux, то пользователь выбирает нужную версию. В разделе дополнительных параметров возможно указать `bs`, генерировать ли `img`-образ,  также выбрать метод сжатия образа (`gz`, `xz`, `zstd`, без сжатия), а также указать имя и версию собираемой системы. Выполнить настройку пользователь может с помощью команды:

```bash
bs config
```

Данные о сборке записываются в файл `.config.toml`. После чего пользователь вводит команду:

```bash
bs build
```

Для сборки системы из исходного кода. В целях безопасности сборка производится от имени только что созданного пользователя.

## Порядок работы

- **Конфигурация:**
  - Чтение файла со списком материнских плат
  - Вывод псевдографического окна со списком, в котором пользователь выбирает одну из плат, для которой нужно собирать систему.
  - Чтение директории с файлами этой платы, чтение конфигурационного файла этой платы.
    - Если в конфиге указана возможность сборки нескольких ядер Linux, то открыть ещё одно окно, в котором запросить у пользователя, какое ядро использовать.
  - Запись собранных сведений в файл `.config.toml`:
    - Плата, для которой выполнять сборку системы.
    - Ядро, которое собирать для этой платы.
    - Имя и версия собираемой системы (обычно вписываются стандартные значения, однако в доп. окне пользователь может изменить имя и версию ОС).
- **Сборка:**
  - ...

## Структура ФС

- `src/` - исходный код `bs`;
- `target/` - скомпилированные файлы `bs`;
- `data/` - конфигурационные файлы и информация для сборки
  - `data/<BOARD NAME>/` - директория с файлами для конкретной материнской платы

## Конфигурация

- `data/mboards.toml` - файл со списком поддерживаемых материнских плат.
- `data/<BOARD NAME>/kernel.toml` - файл с информацией о доступных для сборки ядрах (версия ядра и путь до его конфига).
- `.config.toml` - файл с информацией о том, что собирать и как собирать. Генерируется на основе введённых пользователем данных (`bs config`):
  - имя платы, для которой нужно собирать систему;
  - имя системы и её версия;
  - имя архива ядра, которое нужно собрать;
  - путь до конфига для этой версии ядра;
- `data/defaults.toml` - стандартные параметры `bs` (например, имя и версия собираемой системы).

### Псевдографические конфигурационные окна

1. Окно выбора материнской платы.
2. Окно выбора ядра системы (опционально).
3. Установка имени и версии собираемой системы.
4. "О программе"
5. "Донат"
6. Подтверждение выхода.
